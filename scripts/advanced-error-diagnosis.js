#!/usr/bin/env node

console.log('ğŸ” DIAGNOSTIC AVANCÃ‰ - ERREUR 500 PERSISTANTE')
console.log('')

console.log('âŒ PROBLÃˆME : Erreur 500 persiste malgrÃ© configuration PostgreSQL')
console.log('')

console.log('ğŸ¯ VÃ‰RIFICATIONS Ã€ EFFECTUER :')
console.log('')

console.log('1ï¸âƒ£ VÃ‰RIFIER VARIABLES D\'ENVIRONNEMENT :')
console.log('   ğŸŒ Railway Dashboard â†’ Votre projet')
console.log('   âš™ï¸ Service APPLICATION â†’ Onglet "Variables"')
console.log('')
console.log('   âœ… Variables requises :')
console.log('   â€¢ DATABASE_URL (doit Ãªtre prÃ©sente)')
console.log('   â€¢ JWT_SECRET (votre clÃ© gÃ©nÃ©rÃ©e)')
console.log('   â€¢ NODE_ENV = production')
console.log('   â€¢ NEXT_PUBLIC_APP_URL = https://alamigestion-production.up.railway.app')
console.log('')

console.log('2ï¸âƒ£ VÃ‰RIFIER STATUS POSTGRESQL :')
console.log('   ğŸ—„ï¸ Service PostgreSQL â†’ Status')
console.log('   âœ… Doit Ãªtre "Running" (vert)')
console.log('   âœ… Pas d\'erreurs dans les logs')
console.log('')

console.log('3ï¸âƒ£ TESTER CONNEXION BASE DE DONNÃ‰ES :')
console.log('   ğŸŒ https://alamigestion-production.up.railway.app/api/health')
console.log('   âœ… RÃ©ponse attendue : {"status":"healthy","database":"connected"}')
console.log('   âŒ Si erreur : problÃ¨me de connexion DB')
console.log('')

console.log('4ï¸âƒ£ VÃ‰RIFIER LOGS DE DÃ‰PLOIEMENT :')
console.log('   ğŸ“Š Service APPLICATION â†’ Onglet "Deployments"')
console.log('   ğŸ” Dernier dÃ©ploiement â†’ "View Logs"')
console.log('')
console.log('   ğŸ” Rechercher ces messages :')
console.log('   âœ… "Prisma schema loaded"')
console.log('   âœ… "Generated Prisma Client"')
console.log('   âœ… "Compiled successfully"')
console.log('   âŒ "Environment variable not found: DATABASE_URL"')
console.log('   âŒ "PrismaClientInitializationError"')
console.log('')

console.log('5ï¸âƒ£ CAUSES POSSIBLES ERREUR 500 :')
console.log('')

console.log('   ğŸ—„ï¸ PROBLÃˆME DATABASE_URL :')
console.log('   â€¢ Variable DATABASE_URL absente')
console.log('   â€¢ Format DATABASE_URL incorrect')
console.log('   â€¢ PostgreSQL non dÃ©marrÃ©')
console.log('   â€¢ Connexion rÃ©seau bloquÃ©e')
console.log('')

console.log('   ğŸ”§ PROBLÃˆME PRISMA :')
console.log('   â€¢ Schema Prisma non trouvÃ©')
console.log('   â€¢ Client Prisma non gÃ©nÃ©rÃ©')
console.log('   â€¢ Migrations non appliquÃ©es')
console.log('   â€¢ Version Prisma incompatible')
console.log('')

console.log('   ğŸ“ PROBLÃˆME API SIGNUP :')
console.log('   â€¢ Erreur validation Zod')
console.log('   â€¢ Erreur hashage bcrypt')
console.log('   â€¢ Contrainte unique violÃ©e')
console.log('   â€¢ Timeout base de donnÃ©es')
console.log('')

console.log('6ï¸âƒ£ SOLUTIONS PAR PROBLÃˆME :')
console.log('')

console.log('   ğŸ”§ SI DATABASE_URL MANQUE :')
console.log('   â€¢ RedÃ©marrer service PostgreSQL')
console.log('   â€¢ RedÃ©marrer service APPLICATION')
console.log('   â€¢ VÃ©rifier connexions entre services')
console.log('   â€¢ Ajouter DATABASE_URL manuellement si nÃ©cessaire')
console.log('')

console.log('   ğŸ”§ SI PRISMA Ã‰CHOUE :')
console.log('   â€¢ Forcer nouveau dÃ©ploiement')
console.log('   â€¢ VÃ©rifier prisma/schema.prisma')
console.log('   â€¢ ExÃ©cuter : npx prisma generate')
console.log('   â€¢ ExÃ©cuter : npx prisma db push')
console.log('')

console.log('   ğŸ”§ SI API SIGNUP Ã‰CHOUE :')
console.log('   â€¢ Tester avec donnÃ©es simples')
console.log('   â€¢ VÃ©rifier logs erreur dÃ©taillÃ©s')
console.log('   â€¢ Tester connexion DB directe')
console.log('   â€¢ VÃ©rifier schÃ©ma User en DB')
console.log('')

console.log('7ï¸âƒ£ TESTS DE DIAGNOSTIC :')
console.log('')

console.log('   ğŸ§ª TEST 1 - Health Check :')
console.log('   curl https://alamigestion-production.up.railway.app/api/health')
console.log('   â†’ Si erreur : problÃ¨me DB')
console.log('')

console.log('   ğŸ§ª TEST 2 - DonnÃ©es minimales :')
console.log('   POST /api/auth/signup')
console.log('   {')
console.log('     "name": "Test User",')
console.log('     "email": "test@test.com",')
console.log('     "password": "123456"')
console.log('   }')
console.log('')

console.log('   ğŸ§ª TEST 3 - Console Railway :')
console.log('   â€¢ Ouvrir console Railway')
console.log('   â€¢ npx prisma studio')
console.log('   â€¢ VÃ©rifier tables crÃ©Ã©es')
console.log('')

console.log('8ï¸âƒ£ ACTIONS DE RÃ‰CUPÃ‰RATION :')
console.log('')

console.log('   ğŸ”„ REDÃ‰MARRAGE COMPLET :')
console.log('   1. ArrÃªter service APPLICATION')
console.log('   2. ArrÃªter service PostgreSQL')
console.log('   3. RedÃ©marrer PostgreSQL')
console.log('   4. Attendre 2 minutes')
console.log('   5. RedÃ©marrer APPLICATION')
console.log('   6. Attendre redÃ©ploiement')
console.log('')

console.log('   ğŸ”„ MIGRATION FORCÃ‰E :')
console.log('   1. Console Railway')
console.log('   2. npx prisma migrate reset --force')
console.log('   3. npx prisma migrate deploy')
console.log('   4. npx prisma generate')
console.log('')

console.log('   ğŸ”„ VARIABLES MANUELLES :')
console.log('   Si DATABASE_URL n\'apparaÃ®t pas automatiquement :')
console.log('   â€¢ Copier DATABASE_URL depuis PostgreSQL')
console.log('   â€¢ Ajouter manuellement dans APPLICATION')
console.log('   â€¢ Format : postgresql://user:pass@host:port/db')
console.log('')

console.log('9ï¸âƒ£ INFORMATIONS Ã€ COLLECTER :')
console.log('')

console.log('   ğŸ“Š POUR DIAGNOSTIC :')
console.log('   â€¢ Status des 2 services (APP + DB)')
console.log('   â€¢ Liste complÃ¨te variables APPLICATION')
console.log('   â€¢ Logs dÃ©ploiement (derniÃ¨res 50 lignes)')
console.log('   â€¢ RÃ©ponse /api/health')
console.log('   â€¢ Message erreur exact console navigateur')
console.log('')

console.log('ğŸ”Ÿ ESCALADE SI PROBLÃˆME PERSISTE :')
console.log('')

console.log('   ğŸ†˜ SUPPORT RAILWAY :')
console.log('   â€¢ https://help.railway.app')
console.log('   â€¢ Discord Railway')
console.log('   â€¢ Fournir logs complets')
console.log('')

console.log('   ğŸ”§ SOLUTION ALTERNATIVE :')
console.log('   â€¢ Supprimer et recrÃ©er PostgreSQL')
console.log('   â€¢ Utiliser base externe (Supabase, etc.)')
console.log('   â€¢ DÃ©ployer sur autre plateforme')
console.log('')

console.log('ğŸ’¡ PROCHAINES Ã‰TAPES RECOMMANDÃ‰ES :')
console.log('')

console.log('   1. ğŸ” VÃ©rifiez /api/health en premier')
console.log('   2. ğŸ“Š Collectez logs dÃ©ploiement')
console.log('   3. âš™ï¸ VÃ©rifiez toutes variables')
console.log('   4. ğŸ”„ RedÃ©marrez services si nÃ©cessaire')
console.log('   5. ğŸ§ª Testez avec donnÃ©es simples')
console.log('')

console.log('ğŸ¯ OBJECTIF :')
console.log('   Identifier la cause exacte de l\'erreur 500')
console.log('   pour appliquer la solution appropriÃ©e')
console.log('')

console.log('ğŸ“ BESOIN D\'AIDE :')
console.log('   Partagez les rÃ©sultats de ces vÃ©rifications')
console.log('   pour un diagnostic plus prÃ©cis !')
